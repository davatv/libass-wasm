var SubtitlesOctopus=function(e){var t,a=!1;try{"object"!=typeof WebAssembly||"function"!=typeof WebAssembly.instantiate||(t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0)))instanceof WebAssembly.Module&&(a=new WebAssembly.Instance(t)instanceof WebAssembly.Instance)}catch(e){}console.log("WebAssembly support detected: "+(a?"yes":"no"));var c=this;function r(){var e=c.renderFramesData,t=performance.now();c.ctx.clearRect(0,0,c.canvas.width,c.canvas.height);for(var a,r=0;r<e.canvases.length;r++){var n=e.canvases[r];c.bufferCanvas.width=n.w,c.bufferCanvas.height=n.h;var s=new Uint8ClampedArray(n.buffer);if(c.hasAlphaBug)for(var o=3;o<s.length;o+=4)s[o]=1<=s[o]?s[o]:1;var i=new ImageData(s,n.w,n.h);c.bufferCanvasCtx.putImageData(i,0,0),c.ctx.drawImage(c.bufferCanvas,n.x,n.y)}c.debug&&(a=Math.round(performance.now()-t),void 0!==(t=e.blendTime)?console.log("render: "+Math.round(e.spentTime-t)+" ms, blend: "+Math.round(t)+" ms, draw: "+a+" ms; TOTAL="+Math.round(e.spentTime+a)+" ms"):console.log(Math.round(e.spentTime)+" ms (+ "+a+" ms draw)"),c.renderStart=performance.now())}function n(){var e=c.renderFramesData,t=performance.now();c.ctx.clearRect(0,0,c.canvas.width,c.canvas.height);for(var a=0;a<e.bitmaps.length;a++){var r=e.bitmaps[a];c.ctx.drawImage(r.bitmap,r.x,r.y)}c.debug&&(t=Math.round(performance.now()-t),console.log(e.bitmaps.length+" bitmaps, libass: "+Math.round(e.libassTime)+"ms, decode: "+Math.round(e.decodeTime)+"ms, draw: "+t+"ms"),c.renderStart=performance.now())}c.canvas=e.canvas,c.renderMode=e.lossyRender?"fast":e.blendRender?"blend":"normal",c.libassMemoryLimit=e.libassMemoryLimit||0,c.libassGlyphLimit=e.libassGlyphLimit||0,c.targetFps=e.targetFps||void 0,c.isOurCanvas=!1,c.video=e.video,c.canvasParent=null,c.fonts=e.fonts||[],c.availableFonts=e.availableFonts||[],c.onReadyEvent=e.onReady,c.workerUrl=a?e.workerUrl||"subtitles-octopus-worker.js":e.legacyWorkerUrl||"subtitles-octopus-worker-legacy.js",c.subUrl=e.subUrl,c.subContent=e.subContent||null,c.onErrorEvent=e.onError,c.debug=e.debug||!1,c.lastRenderTime=0,c.pixelRatio=window.devicePixelRatio||1,c.timeOffset=e.timeOffset||0,c.hasAlphaBug=!1,function(){if("function"==typeof ImageData.prototype.constructor)try{return new window.ImageData(new Uint8ClampedArray([0,0,0,0]),1,1)}catch(e){console.log("detected that ImageData is not constructable despite browser saying so")}var r=document.createElement("canvas").getContext("2d");window.ImageData=function(){var e,t=0;arguments[0]instanceof Uint8ClampedArray&&(e=arguments[t++]);var a=arguments[t++],t=r.createImageData(a,arguments[t]);return e&&t.data.set(e),t}}(),c.workerError=function(e){if(console.error("Worker error: ",e),c.onErrorEvent&&c.onErrorEvent(e),!c.debug)throw c.dispose(),new Error("Worker error: "+e)},c.init=function(){window.Worker?(c.worker||(c.worker=new Worker(c.workerUrl),c.worker.onmessage=c.onWorkerMessage,c.worker.onerror=c.workerError),c.workerActive=!1,c.createCanvas(),c.setVideo(e.video),c.setSubUrl(e.subUrl),c.worker.postMessage({target:"worker-init",width:c.canvas.width,height:c.canvas.height,URL:document.URL,currentScript:c.workerUrl,preMain:!0,renderMode:c.renderMode,subUrl:c.subUrl,subContent:c.subContent,fonts:c.fonts,availableFonts:c.availableFonts,debug:c.debug,targetFps:c.targetFps,libassMemoryLimit:c.libassMemoryLimit,libassGlyphLimit:c.libassGlyphLimit})):c.workerError("worker not supported")},c.createCanvas=function(){c.canvas||(c.video?(c.isOurCanvas=!0,c.canvas=document.createElement("canvas"),c.canvas.className="libass-wasm-canvas",c.canvas.style.display="none",c.canvasParent=document.createElement("div"),c.canvasParent.className="libass-wasm-canvas-parent",c.canvasParent.appendChild(c.canvas),c.video.nextSibling?c.video.parentNode.insertBefore(c.canvasParent,c.video.nextSibling):c.video.parentNode.appendChild(c.canvasParent)):c.canvas||c.workerError("Don't know where to render: you should give video or canvas in options.")),c.ctx=c.canvas.getContext("2d"),c.bufferCanvas=document.createElement("canvas"),c.bufferCanvasCtx=c.bufferCanvas.getContext("2d"),c.bufferCanvas.width=1,c.bufferCanvas.height=1;var e=new Uint8ClampedArray([0,255,0,0]),t=new ImageData(e,1,1);c.bufferCanvasCtx.clearRect(0,0,1,1),c.ctx.clearRect(0,0,1,1);e=c.ctx.getImageData(0,0,1,1).data;c.bufferCanvasCtx.putImageData(t,0,0),c.ctx.drawImage(c.bufferCanvas,0,0);t=c.ctx.getImageData(0,0,1,1).data;c.hasAlphaBug=e[1]!=t[1],c.hasAlphaBug&&console.log("Detected a browser having issue with transparent pixels, applying workaround")},c.setVideo=function(e){var t;c.video=e,c.video&&(t=function(){c.setCurrentTime(e.currentTime+c.timeOffset)},c.video.addEventListener("timeupdate",t,!1),c.video.addEventListener("playing",function(){c.setIsPaused(!1,e.currentTime+c.timeOffset)},!1),c.video.addEventListener("pause",function(){c.setIsPaused(!0,e.currentTime+c.timeOffset)},!1),c.video.addEventListener("seeking",function(){c.video.removeEventListener("timeupdate",t)},!1),c.video.addEventListener("seeked",function(){c.video.addEventListener("timeupdate",t,!1),c.setCurrentTime(e.currentTime+c.timeOffset)},!1),c.video.addEventListener("ratechange",function(){c.setRate(e.playbackRate)},!1),c.video.addEventListener("waiting",function(){c.setIsPaused(!0,e.currentTime+c.timeOffset)},!1),document.addEventListener("fullscreenchange",c.resizeWithTimeout,!1),document.addEventListener("mozfullscreenchange",c.resizeWithTimeout,!1),document.addEventListener("webkitfullscreenchange",c.resizeWithTimeout,!1),document.addEventListener("msfullscreenchange",c.resizeWithTimeout,!1),window.addEventListener("resize",c.resizeWithTimeout,!1),"undefined"!=typeof ResizeObserver&&(c.ro=new ResizeObserver(c.resizeWithTimeout),c.ro.observe(c.video)),0<c.video.videoWidth?c.resize():c.video.addEventListener("loadedmetadata",function(e){e.target.removeEventListener(e.type,arguments.callee),c.resize()},!1))},c.getVideoPosition=function(){var e=c.video.videoWidth/c.video.videoHeight,t=c.video.offsetWidth,a=c.video.offsetHeight,r=t,n=a;return e<t/a?r=Math.floor(a*e):n=Math.floor(t/e),{width:r,height:n,x:(t-r)/2,y:(a-n)/2}},c.setSubUrl=function(e){c.subUrl=e},c.renderFrameData=null,c.workerActive=!1,c.frameId=0,c.onWorkerMessage=function(e){c.workerActive||(c.workerActive=!0,c.onReadyEvent&&c.onReadyEvent());var t=e.data;switch(t.target){case"stdout":console.log(t.content);break;case"console-log":console.log.apply(console,JSON.parse(t.content));break;case"console-debug":console.debug.apply(console,JSON.parse(t.content));break;case"console-info":console.info.apply(console,JSON.parse(t.content));break;case"console-warn":console.warn.apply(console,JSON.parse(t.content));break;case"console-error":console.error.apply(console,JSON.parse(t.content));break;case"stderr":console.error(t.content);break;case"window":window[t.method]();break;case"canvas":switch(t.op){case"getContext":c.ctx=c.canvas.getContext(t.type,t.attributes);break;case"resize":c.resize(t.width,t.height);break;case"renderCanvas":c.lastRenderTime<t.time&&(c.lastRenderTime=t.time,c.renderFramesData=t,window.requestAnimationFrame(r));break;case"renderFastCanvas":c.lastRenderTime<t.time&&(c.lastRenderTime=t.time,c.renderFramesData=t,window.requestAnimationFrame(n));break;case"setObjectProperty":c.canvas[t.object][t.property]=t.value;break;default:throw"eh?"}break;case"tick":c.frameId=t.id,c.worker.postMessage({target:"tock",id:c.frameId});break;case"custom":if(!c.onCustomMessage)throw"Custom message received but client onCustomMessage not implemented.";c.onCustomMessage(e);break;case"setimmediate":c.worker.postMessage({target:"setimmediate"});break;case"get-events":console.log(t.target),console.log(t.events);break;case"get-styles":console.log(t.target),console.log(t.styles);break;case"ready":break;default:throw"what? "+t.target}},c.resize=function(e,t,a,r){var n,s=null;a=a||0,r=r||0,e&&t||!c.video||(e=(s=c.getVideoPosition()).width*c.pixelRatio,t=s.height*c.pixelRatio,n=c.canvasParent.getBoundingClientRect().top-c.video.getBoundingClientRect().top,a=s.y-n,r=s.x),e&&t?c.canvas.width==e&&c.canvas.height==t&&c.canvas.style.top==a&&c.canvas.style.left==r||(c.canvas.width=e,c.canvas.height=t,null!=s&&(c.canvasParent.style.position="relative",c.canvas.style.display="block",c.canvas.style.position="absolute",c.canvas.style.width=s.width+"px",c.canvas.style.height=s.height+"px",c.canvas.style.top=a+"px",c.canvas.style.left=r+"px",c.canvas.style.pointerEvents="none"),c.worker.postMessage({target:"canvas",width:c.canvas.width,height:c.canvas.height})):c.video||console.error("width or height is 0. You should specify width & height for resize.")},c.resizeWithTimeout=function(){c.resize(),setTimeout(c.resize,100)},c.runBenchmark=function(){c.worker.postMessage({target:"runBenchmark"})},c.customMessage=function(e,t){c.worker.postMessage({target:"custom",userData:e,preMain:(t=t||{}).preMain})},c.setCurrentTime=function(e){c.worker.postMessage({target:"video",currentTime:e})},c.setTrackByUrl=function(e){c.worker.postMessage({target:"set-track-by-url",url:e})},c.setTrack=function(e){c.worker.postMessage({target:"set-track",content:e})},c.freeTrack=function(e){c.worker.postMessage({target:"free-track"})},c.render=c.setCurrentTime,c.setIsPaused=function(e,t){c.worker.postMessage({target:"video",isPaused:e,currentTime:t})},c.setRate=function(e){c.worker.postMessage({target:"video",rate:e})},c.dispose=function(){c.worker.postMessage({target:"destroy"}),c.worker.terminate(),c.workerActive=!1,c.video&&c.video.parentNode.removeChild(c.canvasParent)},c.createEvent=function(e){c.worker.postMessage({target:"create-event",event:e})},c.getEvents=function(){c.worker.postMessage({target:"get-events"})},c.setEvent=function(e,t){c.worker.postMessage({target:"set-event",event:e,index:t})},c.removeEvent=function(e){c.worker.postMessage({target:"remove-event",index:e})},c.createStyle=function(e){c.worker.postMessage({target:"create-style",style:e})},c.getStyles=function(){c.worker.postMessage({target:"get-styles"})},c.setStyle=function(e,t){c.worker.postMessage({target:"set-style",style:e,index:t})},c.removeStyle=function(e){c.worker.postMessage({target:"remove-style",index:e})},c.init()};"function"==typeof SubtitlesOctopusOnLoad&&SubtitlesOctopusOnLoad(),"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=SubtitlesOctopus);